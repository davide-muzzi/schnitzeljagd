<ion-content class="challenge-page">
  <div class="bg-pulse"></div>

  <div class="page">
    <!-- HEADER -->
    <div class="header">
      <div class="header-left">
        <p class="hello">Hey, {{ playerName }} ðŸ‘‹</p>
        <h1>
          Challenge {{ currentIndex + 1 }}/{{ challenges.length || "Error" }}
        </h1>
        <p class="timer">{{ formattedTime }}</p>
      </div>

      <button class="close-btn" (click)="abort()">
        <img src="../assets/icons/x_cross.svg" alt="Close" />
      </button>
    </div>

    <!-- PROGRESS BAR -->
    <div class="progress-bar">
      <div
        class="progress"
        [style.width.%]="challenges.length ? ((currentIndex + 1) / challenges.length) * 100 : 0"
      ></div>
    </div>

    <!-- CHALLENGE ICON -->
    <div class="challenge-icon" [class.reached]="isDone">
      <div class="status-badge">
        <img
          [src]="isDone ? '../assets/icons/checkmark_white.svg' : '../assets/icons/lightning_bolt_white.svg'"
          [alt]="isDone ? 'Done' : 'Active'"
        />
      </div>

      <img
        [src]="
    currentChallenge?.id === 'geo_target' ? '../assets/icons/pin.svg' :
    currentChallenge?.id === 'distance'   ? '../assets/icons/footsteps.svg' :
    currentChallenge?.id === 'qr'         ? '../assets/icons/qr.svg' :
    currentChallenge?.id === 'charging'   ? '../assets/icons/battery.svg' :
    currentChallenge?.id === 'wifi'       ? '../assets/icons/wifi.svg' :
    '../assets/icons/pin.svg'
  "
        alt="Challenge Icon"
        class="main-icon"
      />
    </div>

    <!-- STATUS / DISTANCE -->
    <div class="distance-info" *ngIf="statusText">{{ statusText }}</div>

    <!-- TITLE -->
    <h2 class="title">{{ currentChallenge?.title || 'Standort finden' }}</h2>

    <!-- DESCRIPTION (FALLBACK ADDED) -->
    <p class="description">
      {{ currentChallenge?.intro || 'Begib dich zum vorgegebenen Standort. Finde
      den Ort mit den Koordinaten.' }}
    </p>

    <!-- STATS -->
    <div class="stats">
      <div class="stat-card">
        <div class="emoji">ðŸ¥©</div>
        <div class="value">{{ gameRun?.schnitzel ?? 0 }}</div>
        <div class="label">Schnitzel</div>
      </div>

      <div class="stat-card">
        <div class="emoji">ðŸ¥”</div>
        <div class="value">{{ gameRun?.kartoffeln ?? 0 }}</div>
        <div class="label">Kartoffeln</div>
      </div>
    </div>

    <!-- PRIMARY ACTION -->
    <button
      class="primary-btn"
      (click)="isDone ? nextChallenge() : primaryAction()"
      [disabled]="!isDone && (currentChallenge?.id === 'geo_target' || currentChallenge?.id === 'distance')"
    >
      <img
        [src]="isDone ? '../assets/icons/checkmark_white.svg' : '../assets/icons/checkmark_white.svg'"
        alt="Action"
      />

      {{ isDone ? 'Challenge abschliessen' : ((currentChallenge?.id === 'geo_target' ||
      currentChallenge?.id === 'distance') ? 'Challenge abschliessen' :
      (currentChallenge?.primaryCta || 'Aktion ausfÃ¼hren')) }}
    </button>

    <!-- SKIP -->
    <button class="skip-btn" (click)="skipChallenge()">
      Challenge Ã¼berspringen
    </button>
  </div>
</ion-content>
